<?xml version="1.0" encoding="utf-8"?>
<!--
////////////////////////////////////////////////////////////////////////////////
//
// Copyright  Â© 2013 E-Learning Research Lab,
// Amrita Vishwa Vidyapeetham. All rights reserved.
// E-Learning Research Lab and the A-VIEW logo are trademarks or
// registered trademarks of E-Learning Research Lab.
// All other names used are the trademarks of their respective owners.
//
////////////////////////////////////////////////////////////////////////////////
-->

<!---

File		: QuestionPaperQuestions.mxml
Module		: Evaluation
Developer(s): Sethu subramanian N, Abhirami, Swati, Radha, Mathiyalakan.
Reviewer(s)	: Vinod Kumar P

This component does the following basic operations :
- displays the questions for a question paper
- allows add/edit/delete specific or random questions
- validating question paper
-->
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"
		   width="100%"
		   height="100%"
		   verticalScrollPolicy="off"
		   horizontalScrollPolicy="off"
		   xmlns:s="library://ns.adobe.com/flex/spark"
		   xmlns:checkBox="edu.amrita.aview.core.shared.components.checkBox.*"
		   xmlns:components="edu.amrita.aview.core.shared.components.*" xmlns:checkBox1="edu.amrita.aview.core.shared.components.checkBox.*">

	<!-- Used to dispatch an event -->
	<mx:Metadata>
		[Event (name="treeUpdated", type = "edu.amrita.aview.core.evaluation.event.UpdateQuestionPaperVOEvent")]
	</mx:Metadata>
	<mx:Script source="QuestionPaperQuestionUIHandler.as"/>
	<mx:Canvas id="canParent"
			   width="100%"
			   height="5%"
			   dropShadowVisible="false"
			   horizontalScrollPolicy="off"
			   verticalScrollPolicy="off">
		<mx:HBox width="100%"
				 paddingLeft="0"
				 verticalAlign="middle"
				 verticalScrollPolicy="off"
				 horizontalScrollPolicy="off">
			<!-- Displays name of question paper and its marks -->
			<!--Fix for Bug#16109-->
			<mx:HBox width="100%" horizontalAlign="center" paddingLeft="10" paddingTop="3"
					 verticalAlign="middle">
				<s:Label color="#000000" fontFamily="Arial" fontSize="15" fontWeight="bold"
						 text="Question paper Name: "/>
				<!-- Fix for Bug #11467
				maxChars for txtQPName is set as 60.
				Limit of Question paper name in data base is 100 charecters,but from UI it is given only 60 so as to hold the delete appender when deleting -->
				<!--Fix for Bug #11005, Bug #11007-->
				<s:TextInput id="txtInpQuestionPaperName" minWidth="100" maxWidth="219"
							 change="{updateQPName()}" color="#000000" fontFamily="Arial"
							 fontSize="15" fontWeight="normal" maxChars="60"
							 skinClass="edu.amrita.aview.core.shared.skins.CustomTextInputSkin"
							 text="{StringUtil.trim(questionPaperVO.questionPaperName)}"
							 textAlign="left"/>
				<s:Label color="#000000" fontFamily="Arial" fontSize="15" fontWeight="bold"
						 text="Maximum Marks : "/>
				<!--Fix for Bug #11005, Bug #11007,19695-->
				<s:TextInput id="txtInpMaxMarks" minWidth="60" maxWidth="80"
							 change="{updateMaxMarks()}" color="#000000" fontFamily="Arial"
							 fontSize="15" fontWeight="normal" maxChars="3"
							 skinClass="edu.amrita.aview.core.shared.skins.CustomTextInputSkin"
							 text="{questionPaperVO.maxTotalMarks}" textAlign="left"/>
			</mx:HBox>

		</mx:HBox>
	</mx:Canvas>
	<!-- Holds the buttons for add , edit , delete -->
	<!--Fix for Bug#16109,16829-->
	<mx:HBox id="hBoxMenu"
			 y="{canParent.height + canParent.y +2}"
			 width="100%"
			 height="5%"
			 verticalAlign="middle"
			 horizontalAlign="center"
			 paddingLeft="10">
		<components:ImageButton width="180" label="Add Specific Question" chromeColor="#E0EFFB"
								click="{addQPQuestions()}" cornerRadius="3" focusEnabled="true"
								fontFamily="Arial"/>
		<mx:Spacer width="10" chromeColor="#E0EFFB"/> 
		<components:ImageButton width="180" label="Add Random Question" chromeColor="#E0EFFB" fontFamily="Arial"
								click="{addQPRandomQuestions()}" focusEnabled="true" cornerRadius="3"/>
		<mx:Spacer width="10" chromeColor="#E0EFFB"/>
		<!--Fix for Bug#16115-->
		<components:ImageButton width="180" label="Edit Question" chromeColor="#E0EFFB" fontFamily="Arial"
								click="{editQPQuestion()}" focusEnabled="true" cornerRadius="3"/>
		<mx:Spacer width="10" chromeColor="#E0EFFB"/>
		<components:ImageButton width="186" label="Delete Question" chromeColor="#E0EFFB" fontFamily="Arial"
								click="{deleteQPQuestion()}" focusEnabled="true" cornerRadius="3"/>
	</mx:HBox>
	<mx:Spacer height="2"/>
	<!-- Displays questions in a question paper -->
	<checkBox1:CheckBoxDataGrid id="dgQPQuestions" y="{hBoxMenu.height+hBoxMenu.y+2}" width="100%"
								height="70%" allowMultipleSelection="true" chromeColor="#E0EFFB"
								color="#000000" dataProvider="{qpQuestions}"
								doubleClickEnabled="false" editable="false" focusEnabled="false"
								fontFamily="Arial"
								rowColorFunction="calculateRowColor" textAlign="left"
								variableRowHeight="true" wordWrap="true">
		<checkBox:columns>
			<checkBox1:CheckBoxHeaderColumn editable="false"
										   width="30"
										   headerRenderer="edu.amrita.aview.core.shared.components.checkBox.CheckBoxHeaderRenderer"
										   itemRenderer="edu.amrita.aview.core.shared.components.checkBox.CheckBoxRenderer"
										   click="{toggleSelection()}"
										   showDataTips="false"/>
			<!-- Column for Serial Nos. -->
			<mx:DataGridColumn minWidth="10"
							   headerText="S.No."
							   labelFunction="getSerialNo"/>
			<!-- Column for Random or Specific type of question -->
			<mx:DataGridColumn dataField="patternType"
							   headerText="Pattern Type"
							   minWidth="10"
							   wordWrap="true"
							   showDataTips="false"/>
			<!-- Column for nos. of random questions -->
			<mx:DataGridColumn headerText="No. of Random Questions"
							   wordWrap="true"
							   dataField="numRandomQuestions"
							   minWidth="5"
							   labelFunction="getNumRandomQuestions"
							   showDataTips="false"/>
			<!-- Column for question text -->
			<mx:DataGridColumn dataField="questionText"
							   headerText="Question"
							   minWidth="100"
							   wordWrap="true"
							   sortCompareFunction="{AViewStringUtil.caselessSortForField('questionText')}"
							   showDataTips="false"/>
			<!-- Column for category -->
			<mx:DataGridColumn headerText="Category"
							   dataField="qbCategoryName"
							   minWidth="10"
							   labelFunction="getCategoryName"
							   editorDataField="value"
							   sortCompareFunction="{AViewStringUtil.caselessSortForField('qbCategoryName')}"
							   showDataTips="false"/>
			<!-- Column for subcategory -->
			<mx:DataGridColumn headerText="Subcategory"
							   dataField="qbSubcategoryName"
							   minWidth="10"
							   labelFunction="getSubcategoryName"
							   editorDataField="value"
							   sortCompareFunction="{AViewStringUtil.caselessSortForField('qbSubcategoryName')}"
							   showDataTips="false"/>
			<!-- Column for difficulty level -->
			<mx:DataGridColumn headerText="Difficulty Level"
							   minWidth="10"
							   dataField="qbDifficultyLevelName"
							   labelFunction="getDifficultyLevel"
							   editorDataField="value"
							   sortCompareFunction="{AViewStringUtil.caselessSortForField('qbDifficultyLevelName')}"
							   showDataTips="false"/>
			<!-- Column for question type -->
			<mx:DataGridColumn headerText="Question Type"
							   minWidth="10"
							   dataField="qbQuestionTypeName"
							   labelFunction="getQuestionType"
							   editorDataField="value"
							   sortCompareFunction="{AViewStringUtil.caselessSortForField('qbQuestionTypeName')}"
							   showDataTips="false"/>
			<!-- Column for marks -->
			<mx:DataGridColumn dataField="marks"
							   headerText="Marks"
							   editable="true"
							   minWidth="5"
							   showDataTips="false">
				<mx:itemEditor>
					<mx:Component>
						<s:TextInput restrict="1-9''"
									 maxChars="3"
									 skinClass="edu.amrita.aview.core.shared.skins.CustomTextInputSkin"/>
					</mx:Component>
				</mx:itemEditor>
			</mx:DataGridColumn>
		</checkBox:columns>
	</checkBox1:CheckBoxDataGrid>
	<mx:Spacer height="1%"/>
	<!-- Holds various info about the questions like its count , total marks etc -->
	<!--Fix for Bug#16109-->
	<mx:HBox id="hBoxSpecific"
			 width="100%"
			 verticalAlign="middle"
			 horizontalAlign="center"
			 y="{dgQPQuestions.height+dgQPQuestions.y}"
			 height="7%">
		<mx:Spacer width="3"/>
		<s:Label color="#000000" fontFamily="Arial" fontSize="14" text="No. of Specific Questions:"/>
		<s:Label id="lblNumberOfSpecficQuestions" color="#000000" fontFamily="Arial" fontSize="14"
				 text="{specificQuestionCount}" textAlign="center"/>
		<s:Label color="#000000" fontFamily="Arial" fontSize="14" text=";  No. of Random Questions:"/>
		<s:Label id="lblNumberOfRandomQuestions" color="#000000" fontFamily="Arial" fontSize="14"
				 text="{randomQuestionCount}" textAlign="center"/>
		<s:Label color="#000000" fontFamily="Arial" fontSize="14" text=";  Total no. of Questions:"/>
		<s:Label id="lblTotalQuestions" color="#000000" fontFamily="Arial" fontSize="14"
				 text="{randomQuestionCount+specificQuestionCount}" textAlign="center"/>
		<s:Label color="#000000" fontFamily="Arial" fontSize="14" text=";  Total Marks:"/>
		<s:Label id="lblTotalMarks" color="#000000" fontFamily="Arial" fontSize="14"
				 text="{totalMark}" textAlign="center"/>
	</mx:HBox>

	<!-- Holds the preview , validate and save buttons -->
	<!--Fix for Bug#16109-->
	<mx:HBox width="100%"
			 paddingTop="10"
			 paddingLeft="10"
			 horizontalAlign="center"
			 y="{hBoxSpecific.height+hBoxSpecific.y}"
			 height="5%">
		<components:ImageButton width="70" label="Preview" chromeColor="#E0EFFB"
								click="{previewQuestionPaper()}" color="#000000" cornerRadius="3"
								focusEnabled="true" fontFamily="Arial" fontSize="12"/>
		<mx:Spacer width="10"/>
		<components:ImageButton id="btnValidate" width="70" label="Validate" chromeColor="#E0EFFB"
								click="{validateQuestionPaper()}" color="#000000" cornerRadius="3"
								focusEnabled="true" fontFamily="Arial" fontSize="12"/>
		<mx:Spacer width="10"/>
		<components:ImageButton id="btnSave" width="70" label="Save" chromeColor="#E0EFFB"
								click="{saveQuestionPaper()}" color="#000000" cornerRadius="3"
								focusEnabled="true" fontFamily="Arial" fontSize="12"
								horizontalCenter="0"/>
	</mx:HBox>


</mx:Canvas>
